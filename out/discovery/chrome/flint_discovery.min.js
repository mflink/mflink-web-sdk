/*! flint-web-sdk build:0.1.0, production. Copyright(C) 2013-2014 www.OpenFlint.org */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){var c,d,e={}.hasOwnProperty,f=function(a,b){function c(){this.constructor=a}for(var d in b)e.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};c=a("eventemitter3"),d=function(a){function b(){this.timeoutId=null,this.timeout=6e4,this.urlBase=null,this.host=null,this.friendlyName=null,this.uniqueId=null}return f(b,a),b.prototype.getUrlBase=function(){return this.urlBase},b.prototype.getHost=function(){return this.host},b.prototype.getName=function(){return this.friendlyName},b.prototype.getUniqueId=function(){return this.uniqueId},b.prototype.getDeviceType=function(){return null},b.prototype.toJson=function(){var a;return a={deviceName:this.friendlyName,urlBase:this.urlBase,host:this.host,uniqueId:this.uniqueId}},b.prototype.triggerTimer=function(){return this._clearTimer(),this.timeoutId=setTimeout(function(a){return function(){return a._onTimeout()}}(this),this.timeout)},b.prototype.clear=function(){return this._clearTimer()},b.prototype._clearTimer=function(){return this.timeoutId?clearTimeout(this.timeoutId):void 0},b.prototype._onTimeout=function(){return this.emit("devicetimeout",this.uniqueId)},b}(c),b.exports=d},{eventemitter3:11}],2:[function(a,b){var c,d,e,f={}.hasOwnProperty,g=function(a,b){function c(){this.constructor=a}for(var d in b)f.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};c=a("eventemitter3"),d=a("./FlintDevice"),e=function(a){function b(){this.devices={},this.ssdpManager=null,this._init()}var c;return g(b,a),c=1e4,b.prototype._init=function(){return this._initSSDP()},b.prototype._createSSDP=function(){throw"Not Implement"},b.prototype._initSSDP=function(){return console.info("init SSDPManager"),this.ssdpManager=this._createSSDP(),this.ssdpManager.on("adddevice",function(a){return function(b){return a._addDevice(b)}}(this)),this.ssdpManager.on("removedevice",function(a){return function(b){return a._removeDevice(b)}}(this))},b.prototype._addDevice=function(a){var b;return b=a.getUniqueId(),this.devices[b]?void 0:(console.log("found device: ",a.getName()),this.devices[b]=a,a.on("devicetimeout",function(a){return function(b){return a._removeDevice(b)}}(this)),this.emit("devicefound",a))},b.prototype._removeDevice=function(a){return this.devices[a]?(console.warn("gone device: ",this.devices[a].getName()),this.emit("devicegone",this.devices[a]),delete this.devices[a]):void 0},b.prototype.start=function(){var a;return null!=(a=this.ssdpManager)?a.start():void 0},b.prototype.stop=function(){var a;return null!=(a=this.ssdpManager)?a.stop():void 0},b.prototype.getDeviceList=function(){var a,b,c,d;a=[],d=this.devices;for(c in d)b=d[c],a.push(b);return a},b}(c),b.exports=e},{"./FlintDevice":1,eventemitter3:11}],3:[function(a,b){var c,d,e,f={}.hasOwnProperty,g=function(a,b){function c(){this.constructor=a}for(var d in b)f.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};c=a("../FlintDeviceScanner"),e=a("./SSDPManagerChrome"),d=function(a){function b(){b.__super__.constructor.apply(this,arguments)}var c;return g(b,a),c=1e4,b.prototype._createSSDP=function(){return new e},b}(c),b.exports=d},{"../FlintDeviceScanner":2,"./SSDPManagerChrome":4}],4:[function(a,b){var c,d,e,f={}.hasOwnProperty,g=function(a,b){function c(){this.constructor=a}for(var d in b)f.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};c=a("../ssdp/SSDPManager"),e=a("./SSDPResponderChrome"),d=function(a){function b(){b.__super__.constructor.apply(this,arguments)}return g(b,a),b.prototype._createSSDPResponder=function(a){return new e(a)},b.prototype._createXhr=function(){return new XMLHttpRequest},b}(c),b.exports=d},{"../ssdp/SSDPManager":9,"./SSDPResponderChrome":5}],5:[function(a,b){var c,d,e,f={}.hasOwnProperty,g=function(a,b){function c(){this.constructor=a}for(var d in b)f.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};c=a("../ssdp/SSDPResponder"),e=a("./UdpSocketChrome"),d=function(a){function b(a){this.options=a,b.__super__.constructor.call(this,a)}return g(b,a),b.prototype._createUdpSocket=function(a){return new e(a)},b}(c),b.exports=d},{"../ssdp/SSDPResponder":10,"./UdpSocketChrome":6}],6:[function(a,b){var c,d,e={}.hasOwnProperty,f=function(a,b){function c(){this.constructor=a}for(var d in b)e.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};c=a("eventemitter3"),d=function(a){function b(a){this.options=a,this.localPort_=a.localPort,this.loopback_=a.loopback,this.socketId_=-1,this._init()}return f(b,a),b.ab2str=function(a){return String.fromCharCode.apply(null,new Uint8Array(a))},b.str2ab=function(a){var b,c,d,e;b=new ArrayBuffer(a.length),c=new Uint8Array(b);for(d in a)e=a[d],c[d]=a.charCodeAt(d);return b},b.prototype._init=function(){var a;return a={persistent:!1,name:"Flint",bufferSize:4096},chrome.sockets.udp.create(a,function(a){return function(c){return a.socketId_=c.socketId,console.log("create UdpSocket: ",a.socketId_),chrome.sockets.udp.setMulticastLoopbackMode(a.socketId_,a.loopback_,function(b){return console.log("setMulticastLoopbackMode UdpSocket: loopback=",a.loopback_,", result=",b)}),chrome.sockets.udp.bind(a.socketId_,"0.0.0.0",a.localPort_,function(b){return console.log("bind UdpSocket: port=",a.localPort_,", result=",b),a.emit("bind")}),chrome.sockets.udp.onReceive.addListener(function(c){return a.socketId_===c.socketId?a._onMessage(b.ab2str(c.data)):void 0}),chrome.sockets.udp.onReceive.addListener(function(b){return a.socketId_===b.socketId?a._onError("error"):void 0}),a.emit("create")}}(this))},b.prototype._onMessage=function(a){return this.onPacket?this.onPacket(a):void 0},b.prototype._onError=function(a){return this.onError?this.onError(a):void 0},b.prototype.joinMulticastGroup=function(a){return-1===this.socketId_?this.once("create",function(b){return function(){return b._joinMulticastGroup(a)}}(this)):this._joinMulticastGroup(a)},b.prototype._joinMulticastGroup=function(a){return chrome.sockets.udp.joinGroup(this.socketId_,a,function(){return function(b){return console.log("joinGroup UdpSocket: addr=",a,", result=",b)}}(this))},b.prototype.send=function(a,c,d){var e;if(-1!==this.socketId_)return e=b.str2ab(a),chrome.sockets.udp.send(this.socketId_,e,c,d,function(){return function(a){return a.resultCode<0?console.error("UdpSocket: send error!!!"):console.log("UdpSocket: send success, ",a.bytesSent)}}(this))},b.prototype.close=function(){return this.socketId_?chrome.sockets.udp.close(this.socketId_,function(a){return function(){return console.log("socket closed! ",a.socketId_)}}(this)):void 0},b}(c),b.exports=d},{eventemitter3:11}],7:[function(a){window.FlintDeviceScanner=a("./FlintDeviceScannerChrome")},{"./FlintDeviceScannerChrome":3}],8:[function(a,b){var c,d,e={}.hasOwnProperty,f=function(a,b){function c(){this.constructor=a}for(var d in b)e.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};c=a("../FlintDevice"),d=function(a){function b(a){b.__super__.constructor.apply(this,arguments),this.urlBase=a.urlBase,":9431"!==this.urlBase.slice(-5)&&(this.urlBase+=":9431"),this.host=this.urlBase.replace("http://",""),this.host=this.host.replace(":9431",""),this.friendlyName=a.friendlyName,this.uniqueId=a.udn}return f(b,a),b.prototype.getDeviceType=function(){return"ssdp"},b}(c),b.exports=d},{"../FlintDevice":1}],9:[function(a,b){var c,d,e,f,g={}.hasOwnProperty,h=function(a,b){function c(){this.constructor=a}for(var d in b)g.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};c=a("eventemitter3"),f=a("./SSDPResponder"),d=a("./SSDPDevice"),e=function(a){function b(){this.devices={},this.ssdp=this._createSSDPResponder({st:"urn:dial-multiscreen-org:service:dial:1"}),this.ssdp.on("serviceFound",function(a){return function(b){return a.devices[b]?a.devices[b].triggerTimer?a.devices[b].triggerTimer():void 0:(a.devices[b]=b,a._fetchDeviceDesc(b))}}(this)),this.ssdp.on("serviceLost",function(a){return function(b){var c;return a.devices[b]?(c=a.devices[b],a.emit("removedevice",c),c.clear(),delete a.devices[b]):void 0}}(this))}return h(b,a),b.prototype._createSSDPResponder=function(){throw"Not Implement"},b.prototype.start=function(){return this.ssdp.start()},b.prototype.stop=function(){return this.ssdp.stop()},b.prototype._fetchDeviceDesc=function(a){var b;if(b=this._createXhr(),!b)throw"_fetchDeviceDesc: failed";return b.open("GET",a),b.onreadystatechange=function(c){return function(){return 4===b.readyState?c._parseDeviceDesc(b.responseText,a):void 0}}(this),b.send("")},b.prototype._createXhr=function(){throw"Not Implement"},b.prototype._parseDeviceDesc=function(a,b){var c,d,e,f,g,h;try{if(h=null,window.DOMParser?(e=new DOMParser,h=e.parseFromString(a,"text/xml")):(h=new ActiveXObject("Microsoft.XMLDOM"),h.async="false",h.loadXML(a)),f=null,g=h.querySelectorAll("URLBase"),g&&g.length>0&&(f=g[0].innerHTML),c=h.querySelectorAll("device"),c.length>0)return this._parseSingleDeviceDesc(c[0],f,b)}catch(i){return d=i,console.error(d)}},b.prototype._parseSingleDeviceDesc=function(a,b,c){var e,f,g,h,i,j;return f=a.querySelector("deviceType").innerHTML,j=a.querySelector("UDN").innerHTML,g=a.querySelector("friendlyName").innerHTML,h=a.querySelector("manufacturer").innerHTML,i=a.querySelector("modelName").innerHTML,e=new d({uniqueId:j,urlBase:b,deviceType:f,udn:j,friendlyName:g,manufacturer:h,modelName:i}),e.triggerTimer(),this.devices[c]=e,this.emit("adddevice",e)},b}(c),b.exports=e},{"./SSDPDevice":8,"./SSDPResponder":10,eventemitter3:11}],10:[function(a,b){var c,d,e,f,g,h,i,j,k,l,m={}.hasOwnProperty,n=function(a,b){function c(){this.constructor=a}for(var d in b)m.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};c=a("eventemitter3"),d=5e3,j=1900,f="239.255.255.250",g=10,h="M-SEARCH * HTTP/1.1\r\nHOST: "+f+":"+j+'\r\nMAN: "ssdp:discover"\r\nMX: '+g+"\r\nST: %SEARCH_TARGET%\r\n\r\n",k=/HTTP\/\d{1}\.\d{1} \d+ .*/,i=/^([^:]+):\s*(.*)$/,l="urn:dial-multiscreen-org:service:dial:1",e=function(a){function b(a){this.options=a,this.socket=null,this.searchTimerId=null,this.started=!1}return n(b,a),b.prototype._init=function(){return this.socket=this._createUdpSocket({loopback:!1,localPort:j}),this.socket.joinMulticastGroup(f),this.socket.onPacket=function(a){return function(b){return a._onData(b)}}(this)},b.prototype._createUdpSocket=function(){throw"Not Implement"},b.prototype.start=function(){if(this.started)throw"SSDPResponder already started";return this.started=!0,this._init(),this.searchTimerId=setInterval(function(a){return function(){return a._search()}}(this),d),this._search()},b.prototype._search=function(){var a,b;return a=h,b=a.replace("%SEARCH_TARGET%",l),this.socket.send(b,f,j)},b.prototype.stop=function(){return this.started?(this.started=!1,this.searchTimerId&&clearInterval(this.searchTimerId),this.socket.close()):void console.warn("SSDPResponder is not started")},b.prototype._onData=function(a){var b,c,d,e;if(d=a.toString().split("\r\n"),b=d.shift(),e=k.test(b)?"RESPONSE":b.split(" ")[0].toUpperCase(),c={},d.forEach(function(){return function(a){var b;return a.length&&(b=a.match(i))?c[b[1].toLowerCase()]=b[2]:void 0}}(this)),"M-SEARCH"===e);else{if("RESPONSE"===e)return this._onResponse(c);if("NOTIFY"===e)return this._onNotify(c)}},b.prototype._onResponse=function(a){return a.location&&this.options.st===a.st?this.emit("serviceFound",a.location):void 0},b.prototype._onNotify=function(a){if(a.location&&this.options.st===a.nt){if("ssdp:alive"===a.nts)return this.emit("serviceFound",a.location);if("ssdp:byebye"===a.nts)return this.emit("serviceLost",a.location)}},b}(c),b.exports=e},{eventemitter3:11}],11:[function(a,b){"use strict";function c(a,b,c){this.fn=a,this.context=b,this.once=c||!1}function d(){}d.prototype._events=void 0,d.prototype.listeners=function(a){if(!this._events||!this._events[a])return[];if(this._events[a].fn)return[this._events[a].fn];for(var b=0,c=this._events[a].length,d=new Array(c);c>b;b++)d[b]=this._events[a][b].fn;return d},d.prototype.emit=function(a,b,c,d,e,f){if(!this._events||!this._events[a])return!1;var g,h,i=this._events[a],j=arguments.length;if("function"==typeof i.fn){switch(i.once&&this.removeListener(a,i.fn,!0),j){case 1:return i.fn.call(i.context),!0;case 2:return i.fn.call(i.context,b),!0;case 3:return i.fn.call(i.context,b,c),!0;case 4:return i.fn.call(i.context,b,c,d),!0;case 5:return i.fn.call(i.context,b,c,d,e),!0;case 6:return i.fn.call(i.context,b,c,d,e,f),!0}for(h=1,g=new Array(j-1);j>h;h++)g[h-1]=arguments[h];i.fn.apply(i.context,g)}else{var k,l=i.length;for(h=0;l>h;h++)switch(i[h].once&&this.removeListener(a,i[h].fn,!0),j){case 1:i[h].fn.call(i[h].context);break;case 2:i[h].fn.call(i[h].context,b);break;case 3:i[h].fn.call(i[h].context,b,c);break;default:if(!g)for(k=1,g=new Array(j-1);j>k;k++)g[k-1]=arguments[k];i[h].fn.apply(i[h].context,g)}}return!0},d.prototype.on=function(a,b,d){var e=new c(b,d||this);return this._events||(this._events={}),this._events[a]?this._events[a].fn?this._events[a]=[this._events[a],e]:this._events[a].push(e):this._events[a]=e,this},d.prototype.once=function(a,b,d){var e=new c(b,d||this,!0);return this._events||(this._events={}),this._events[a]?this._events[a].fn?this._events[a]=[this._events[a],e]:this._events[a].push(e):this._events[a]=e,this},d.prototype.removeListener=function(a,b,c){if(!this._events||!this._events[a])return this;var d=this._events[a],e=[];if(b&&(d.fn&&(d.fn!==b||c&&!d.once)&&e.push(d),!d.fn))for(var f=0,g=d.length;g>f;f++)(d[f].fn!==b||c&&!d[f].once)&&e.push(d[f]);return e.length?this._events[a]=1===e.length?e[0]:e:delete this._events[a],this},d.prototype.removeAllListeners=function(a){return this._events?(a?delete this._events[a]:this._events={},this):this},d.prototype.off=d.prototype.removeListener,d.prototype.addListener=d.prototype.on,d.prototype.setMaxListeners=function(){return this},d.EventEmitter=d,d.EventEmitter2=d,d.EventEmitter3=d,b.exports=d},{}]},{},[7]);